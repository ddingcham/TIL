# NoSQL 모델링  
#### 요즘 버전의 NoSQL 기반 Storage랑은 좀 달라도, 개론은 이해하고 넘어가기 위해  

## 주요 참고자료  
#### [NoSQL 데이타 모델링 #1-데이타모델과, 모델링 절차](https://bcho.tistory.com/665)  
#### [NoSQL 데이타 모델링 #2- 데이타 모델링 패턴](https://bcho.tistory.com/666?category=431293)  

## [미리 결론] 데이터 모델 관점에서 RDBMS와 NoSQL 특징 비교  
#### // 절대 NoSQL 이 만능이 아님  

* 데이터의 관계  
  * RDBMS  
    > FK 등을 기반으로 데이터의 관계를 정의한 후 JOIN 같은 관계형 연산 수행    
  * NoSQL  
    > 기본적으로 데이터 간의 관계를 정의하지 않음  
* 확장성  
  * RDBMS  
    > 데이터의 무결성 및 정합성을 보장하기 위해 정규화된 데이터 모델 사용  
    #### 비즈니스 요구사항을 만족시키기 위해서는 JOIN이 필수적이고, JOIN(데이터 간 관계 연산)에 대한 고려로 인한 복잡성 증가  
  * NoSQL  
    #### 독립된 데이터 모델은 여러 서버에 분산 시키는 것이 용이하다    
* 스키마  
  * RDBMS  
    > 데이터 모델의 스키마 변경 시 추가 작업 필요(비용이 많이듬 - 복잡성, 성능)  
  * NoSQL  
    > Schema-less 구조를 취함으로써 얻어지는 유연하고, 다양하게 데이터를 저장 가능  
    
## NoSQL 개요  
### 데이터 구조를 기본적으로 크게 3가지 패턴으로 구분  

* 1.Key/Value Store  
  > Unique한 key를 기반으로 단 하나의 value를 매핑  
  * Column Family  
    > primitive 뿐만이 아니라 모델 단위(ex] Record 형태)로 매핑하기 위해  
    > key에 매핑된 value 내부적으로 다시 (Column,Value) 여러 쌍을 갖는 개념  
        
* 2.Ordered Key/Value Store   
  > Key/Value Store 개념에서 내부적으로 Key를 Sorting해서 저장  
  
    NoSQL은 RDBMS의 Order By와 같은 기능을 제공하지 않기 때문에  
    #### 결과값을 업데이트 날짜등으로 소팅해서 보여주는 것은 이 Ordered Key/Value Store가 절대적으로 유리하다.  
    
* 3.Document Key/Value Store  
  > Key에 XML,JSON,YAML 등의 구조화된 데이터 타입(**Document**)을 매핑  
  > 복잡한 계층 구조를 표현  
  
### NoSQL 공통적인 이슈들  

* Sorting  
  > SQL의 Order By  
* Join  
  > RDBMS에서 두 개 이상의 Table을 외래키로 조인  
* Grouping  
  > SQL문의 group by  
* Range Query  
  > where key>'start' and key<'end' 같은 범위 쿼리  
* Index  
  > select query 성능 향상  
  
## NoSQL 데이터 모델링의 시작  
#### 기존 RDBMS 관점을 전환해, 데이터를 바라보는 시각과 접근방법을 바꿔야함  

### 데이터에 대한 근본적인 사상 전환  

* 개체(Entity) 모델 지향에서 쿼리 지향 모델링  
  * RDBMS 모델링 순서  
    * 저장하고자하는 도메인 모델 분석  
    * 개체(Entity)간의 관계(Relationship) 식별  
    * 테이블 추출  
    * 테이블 베이스로 쿼리 구현을 통한 결과 추출  
  #### 접근 방법을 역순으로 진행 !  
  * NoSQL 모델링 순서  
    * 도메인 모델 분석  
    * 쿼리 결과  
    * 테이블(주로 Document) 디자인  
    
  NoSQL은 복잡한 쿼리 기능이 부족하므로,
  #### 도메인 모델에서 어떤 쿼리 결과가 필요한 지를 정의하고, 해당 쿼리 결과를 얻기위한 영속화 모델 디자인  
  
* 정규화(Normalization)에서 비(역)정규화(Denormalization)  
  * ACID 관련  
    > RDBMS 모델링에서는 데이타의 일관성과 도메인 모델과의 일치성을 위해서 데이타 모델을 정규화  
    > 특히 **같은 데이타(value)가 두개 이상의 테이블에 중복 저장되는 것을 지양**
  * **NoSQL은 반대의 접근 방법이 필요**  
    > 쿼리의 효율성을 위해, 의도적으로 중복된 데이터를 저장하는 등  **비정규화된 데이터 모델 설계 방식을 지향**  
    
### NoSQL 데이터 모델링 절차  
#### https://bcho.tistory.com/665 다시 들어가서 command+F "NoSQL 데이터 모델링 절차" 후 예제 확인  
* **1.도메인 모델 파악**  
  > 어떤 도메인 엔티티가 있고, 엔티티간의 관계는 어떻게 되는지 등을 분석  
  > ERD를 그려서 도식화  
  #### 과정 자체는 필수가 아니지만, 저장할 도메인 데이터에 대한 명확한 이해는 필수적이므로,  
  #### 도메인 모델 분석 과정을 거치는 게 좋다. // 바로 어플리케이션 관점으로 접근하기 보다는    
  
* **2.쿼리 결과 디자인 (데이터 출력형태 디자인)**  
  > "**도메인 모델**"을 기반으로 애플리케이션에 의해서 쿼리 되는 결과값을 먼저 결정  
  #### 요구사항 스펙에 대한 명확한 구체화와 이해가 필수적으로 선행되어야 할 것 같음  
  NoSQL의 데이타 모델링은 도메인 모델을 중심으로 하는 것이 아니라, 이 애플리케이션의 데이타 출력 내용을 기반으로 하기 때문  
  
* **3.패턴을 이용한 데이터 모델링**  
  #### IO 횟수를 줄이는 데 초점을 둔다. // Demoralization이 가장 중요    
  > 조인이 없으니, 한 번의 데이터 요청이 사용자 요청을 만족시킬 수 있도록...  
  #### Ordered Key 개념을 고려한다면 key 자체가 소팅을 위한 팩터로 활용될 수 있다면 더 좋겟지..  
  
* **4.최적화를 위해 필요한 기능 리스팅**  
  > ex) elasticsearch에서 시간 기반으로 데이터를 나눠서 인덱싱하여 관리  
  > [관련 공부](https://github.com/ddingcham/TIL/blob/master/elasticsearch/es에서 검색으로 조회될(안될)데이터 관리.md)  
  
* **5.NoSQL 후보군들 간의 비교**  
* **6.데이터 모델을 선정된 NoSQL에 최적화 및 하드웨어 디자인**  

## NoSQL 데이터 모델링 패턴  
#### 필요한 유즈케이스에 맞춰서 그 때 그 때 참고할 내용들 위주였음    
https://bcho.tistory.com/666?category=431293
#### 결론
```
지금까지 몇가지 NoSQL 적용시 사용할 수 있는 데이타 모델링 패턴에 대해서 살펴보았다. 
기본 패턴은 대부분의 NoSQL 솔루션에 적용할 수 있으며, 
확장된 모델링 패턴의 경우에는 NoSQL이 지원하는 기능이나 데이타 구조 (KV, Ordered KV,Document etc)에 따라서 적용할 수 있다.

NoSQL을 이용한 시스템을 개발할때는

1.     데이타 모델링이 80% 이상이다. 
선정한 NoSQL과 애플리케이션의 특성에 맞는 데이타 모델링에 집중하자.

2.     NoSQL은 어떤 솔루션이 좋다, 나쁘다가 없다. 
어떤 솔루션이 특성이 어떻다는 것만 있기 때문에 반드시 데이타 모델과 내부 아키텍쳐 두 가지를 파악한 후에, 
애플리케이션의 특성에 맞는 NoSQL을 선정해야 한다.

3.     하나의 NoSQL로 전체 데이타를 저장하려고 하지 마라. 
NoSQL은 데이타 구조가 매우 다눈하지만, 애플리케이션들은 하나의 단순한 데이타 구조로 저장할 수 없는 데이타가 반드시 존재한다. 
RDBMS와 혼용하거나, 다른 NoSQL과 혼용하거나 성능면에서는 캐슁 솔루션과 혼용하는 것을 반드시 고려 해야한다.

NoSQL은 놀라온 성능과 확장성을 제공하지만, 많은 연구와 노력이 필요하다.
Oracle과 같은 데이타베이스를 사용할때도, 전문 DBA를 두고, 튜닝에 시간을 두고, 데이타 모델을 가꾸고, 튜닝을 하지 않는가?
NoSQL이 오픈소스를 중심으로 사용되고 있지만, 오픈 소스라서 쉬운게 아니다. 
그만큼 많은 투자와 연구와 노력이 필요한 만큼, 신중하게 검토하고 도입을 결정하기를 바란다.

출처: https://bcho.tistory.com/666?category=431293 [조대협의 블로그]
```

요즘 NoSQL 기반의 Storage가 조인 비슷한 개념을 지원하는 지 안하는 지는 중요하지 않은 것 같음.
#### 정석적인 정규화 관점에만 갇혀 있기 보다는 필요에 따라 다양한 관점으로 데이터를 바라보는 게 더 중요한 것 같음.
#### 해야될 일을 잘 분류, 분석 할줄 알아야 함
